{% extends 'base.html' %}
{% load static humanize %}

{% block content %}
<section id="my-listings-screen" class="screen-page">
    <div class="modal-header">
        <h3>My Listings</h3>
        <a href="{% url 'profile' %}" class="btn-icon"><i class="ph ph-arrow-left"></i></a>
    </div>

    <div class="listings-grid" style="padding: 16px;">
        {% for house in user_listings %}
        <div class="card">
            <a href="{% url 'listing_detail' house.id %}" style="text-decoration:none; color:inherit;">
                {% if house.image %}
                <img src="{{ house.image.url }}" class="card-image" alt="{{ house.title }}">
                {% else %}
                <div class="card-image" style="background:#f0f0f0; display:flex; align-items:center; justify-content:center; color:#aaa;">
                    <i class="ph ph-image" style="font-size:2rem;"></i>
                </div>
                {% endif %}
                <div class="card-content">
                    <div style="display:flex;justify-content:space-between;align-items:start;">
                        <div class="card-price">
                            ₦{{ house.rent|intcomma }}
                            {% if house.listing_type == 'roommate' %}
                            <span style="font-size:0.75rem; color:var(--text-muted); font-weight:normal;">(50% Share)</span>
                            {% endif %}
                        </div>
                        <small>{{ house.created_at|timesince }} ago</small>
                    </div>
                    
                    <h3 style="font-size:1rem;margin:4px 0;">{{ house.title }}</h3>
                    <div class="card-meta">{{ house.get_listing_type_display }} • {{ house.location }}</div>

                    <div style="margin-top:8px; display:flex; gap:4px; flex-wrap:wrap;">
                        <span class="badge" style="background:#f3f4f6; color:#4b5563;"><i class="ph ph-eye"></i> {{ house.views_count }} Views</span>
                        
                        {% if house.listing_type != 'roommate' %}
                            {% if house.is_verified_listing %}
                            <span class="badge badge-verified"><i class="ph-fill ph-seal-check"></i> Verified</span>
                            {% else %}
                            <span class="badge" style="background:#FEF3C7; color:#B45309;">Unverified</span>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </a>
            
            <div style="padding: 12px; border-top: 1px solid #eee; display:flex; gap: 8px;">
                <a href="{% url 'edit_listing' house.id %}" class="btn btn-secondary" style="flex:1; font-size:0.9rem; padding: 8px;"><i class="ph ph-pencil-simple"></i> Edit</a>
                <a href="{% url 'delete_listing' house.id %}" class="btn btn-secondary" style="flex:1; font-size:0.9rem; padding: 8px; color: #ef4444; border-color: #fee2e2; background: #fef2f2;" onclick="return confirm('Are you sure you want to delete this listing?')"><i class="ph ph-trash"></i> Delete</a>
            </div>
        </div>
        {% empty %}
        <div style="text-align:center; padding: 40px 20px;">
            <div style="width:60px; height:60px; background:#f3f4f6; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 16px;">
                <i class="ph ph-house" style="font-size:24px; color:#9ca3af;"></i>
            </div>
            <h3 style="color:#374151; margin-bottom:8px;">No listings yet</h3>
            <p style="color:#6b7280; margin-bottom:24px;">You haven't posted any listings yet.</p>
            <a href="{% url 'post' %}" class="btn btn-primary">Post a Listing</a>
        </div>
        {% endfor %}
    </div>
</section>
{% endblock %}
